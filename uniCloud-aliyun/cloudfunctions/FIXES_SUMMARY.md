# è¯„ä¼°ä¸Šä¼ é—®é¢˜ä¿®å¤æ€»ç»“

## ğŸ” å‘ç°çš„é—®é¢˜

### 1. **level æšä¸¾å€¼ä¸åŒ¹é…** âŒ
- **é—®é¢˜**ï¼šæ•°æ®åº“ schema è¦æ±‚ level å€¼ä¸º `["ä¼˜ç§€", "è‰¯å¥½", "æ­£å¸¸", "éœ€å…³æ³¨", "éœ€å¹²é¢„"]`
- **é”™è¯¯**ï¼š`submitAssessment` äº‘å‡½æ•°çš„ `calculateLevel` è¿”å› `"A"`, `"B"`, `"C"`
- **å½±å“**ï¼šæ•°æ®åº“éªŒè¯å¤±è´¥ï¼Œæ— æ³•å†™å…¥è®°å½•

### 2. **ç¼ºå°‘é”™è¯¯æ—¥å¿—** âŒ
- **é—®é¢˜**ï¼šäº‘å‡½æ•°ç¼ºå°‘è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯
- **å½±å“**ï¼šéš¾ä»¥å®šä½ä¸Šä¼ å¤±è´¥çš„å…·ä½“åŸå› 

### 3. **è‰ç¨¿æŸ¥è¯¢ç¼ºå°‘ ownerUid åŒ¹é…** âš ï¸
- **é—®é¢˜**ï¼šæŸ¥æ‰¾ç°æœ‰è‰ç¨¿æ—¶åªåŒ¹é… `childId` å’Œ `source`ï¼Œå¯èƒ½è·¨ç”¨æˆ·å†²çª
- **å½±å“**ï¼šæ½œåœ¨çš„æ•°æ®å®‰å…¨é—®é¢˜

### 4. **æ•°æ®åº“å†™å…¥é”™è¯¯å¤„ç†ä¸å®Œå–„** âš ï¸
- **é—®é¢˜**ï¼šæ•°æ®åº“å†™å…¥å¤±è´¥æ—¶æ²¡æœ‰è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- **å½±å“**ï¼šéš¾ä»¥æ’æŸ¥å†™å…¥å¤±è´¥åŸå› 

## âœ… å·²ä¿®å¤

### 1. ä¿®å¤ level æšä¸¾å€¼
**æ–‡ä»¶**ï¼š`uniCloud-aliyun/cloudfunctions/submitAssessment/calc.js`

```javascript
// ä¿®å¤å‰
function calculateLevel(scorePercent) {
  if (scorePercent >= 85) return 'A';
  if (scorePercent >= 70) return 'B';
  return 'C';
}

// ä¿®å¤å
function calculateLevel(scorePercent) {
  if (scorePercent >= 90) return 'ä¼˜ç§€';
  if (scorePercent >= 75) return 'è‰¯å¥½';
  if (scorePercent >= 60) return 'æ­£å¸¸';
  if (scorePercent >= 40) return 'éœ€å…³æ³¨';
  return 'éœ€å¹²é¢„';
}
```

### 2. å¢å¼ºé”™è¯¯æ—¥å¿—
**æ–‡ä»¶**ï¼š`submitAssessment/index.js`, `saveAssessment/index.js`

æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼š
- åŠ è½½é¢˜ç›®æ—¶çš„ç­”æ¡ˆæ•°é‡å’Œç¤ºä¾‹
- æ‰¾åˆ°çš„é¢˜ç›®æ•°é‡
- æœªæ‰¾åˆ°çš„é¢˜ç›®æ•°é‡å’Œç¤ºä¾‹
- æ•°æ®åº“å†™å…¥å‰çš„æ•°æ®æ‘˜è¦
- æ•°æ®åº“å†™å…¥å¤±è´¥æ—¶çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

### 3. ä¿®å¤è‰ç¨¿æŸ¥è¯¢
**æ–‡ä»¶**ï¼š`saveAssessment/index.js`

```javascript
// ä¿®å¤å‰
.where({
  childId: String(childId),
  source: 'draft'
})

// ä¿®å¤å
.where({
  childId: String(childId),
  ownerUid: uid,
  source: 'draft'
})
```

### 4. å¢å¼ºæ•°æ®åº“å†™å…¥é”™è¯¯å¤„ç†
**æ–‡ä»¶**ï¼š`submitAssessment/index.js`, `saveAssessment/index.js`

æ·»åŠ äº† try-catch åŒ…è£…ï¼Œåœ¨å†™å…¥å¤±è´¥æ—¶ï¼š
- è¾“å‡ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- è¿”å›ç”¨æˆ·å‹å¥½çš„é”™è¯¯æ¶ˆæ¯
- è®°å½•æ•°æ®æ‘˜è¦ç”¨äºè°ƒè¯•

## ğŸ“‹ æ•°æ®åº“ Schema è¦æ±‚

### assessments é›†åˆ required å­—æ®µ
æ ¹æ® `assessments.schema.json`ï¼Œä»¥ä¸‹å­—æ®µæ˜¯**å¿…å¡«**çš„ï¼š

1. âœ… `childId` - å·²åŒ…å«
2. âœ… `ownerUid` - å·²åŒ…å«ï¼ˆä» `context.auth.uid` è·å–ï¼‰
3. âœ… `answers` - å·²åŒ…å«ï¼ˆç»è¿‡éªŒè¯çš„æœ‰æ•ˆç­”æ¡ˆï¼‰
4. âœ… `stats` - å·²åŒ…å«ï¼ˆè®¡ç®—åçš„ç»Ÿè®¡ä¿¡æ¯ï¼‰
5. âœ… `createdAt` - å·²åŒ…å«ï¼ˆè‰ç¨¿åˆ›å»ºæ—¶è®¾ç½®ï¼Œæäº¤æ—¶è®¾ç½®ï¼‰

### level å­—æ®µæšä¸¾å€¼
- âœ… å¿…é¡»æ˜¯ï¼š`"ä¼˜ç§€"`, `"è‰¯å¥½"`, `"æ­£å¸¸"`, `"éœ€å…³æ³¨"`, `"éœ€å¹²é¢„"` ä¹‹ä¸€
- âœ… å·²ä¿®å¤ä¸ºä½¿ç”¨ä¸­æ–‡ç­‰çº§

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. æ£€æŸ¥äº‘å‡½æ•°æ—¥å¿—
åœ¨ uniCloud Web æ§åˆ¶å°æŸ¥çœ‹äº‘å‡½æ•°æ‰§è¡Œæ—¥å¿—ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ï¼š
- `[submitAssessment] åŠ è½½é¢˜ç›®ï¼Œç­”æ¡ˆæ•°é‡: X`
- `[submitAssessment] æ‰¾åˆ°é¢˜ç›®æ•°é‡: Y`
- `[submitAssessment] æˆåŠŸæäº¤è¯„ä¼°` æˆ–é”™è¯¯ä¿¡æ¯

### 2. éªŒè¯æ•°æ®å†™å…¥
æ£€æŸ¥æ•°æ®åº“ `assessments` é›†åˆï¼š
- æ–°æäº¤çš„è®°å½•åº”è¯¥æœ‰ `source: 'submit'`
- `level` å­—æ®µåº”è¯¥æ˜¯ä¸­æ–‡ç­‰çº§ï¼ˆä¸æ˜¯ A/B/Cï¼‰
- æ‰€æœ‰ required å­—æ®µéƒ½åº”è¯¥å­˜åœ¨

### 3. å¸¸è§é”™è¯¯æ’æŸ¥

#### é”™è¯¯ï¼šæœªæ‰¾åˆ°å¯¹åº”çš„é¢˜ç›®æ•°æ®
**åŸå› **ï¼šæ•°æ®åº“ä¸­ `questions_master` é›†åˆæ²¡æœ‰å¯¹åº”çš„ `qid` è®°å½•
**è§£å†³**ï¼š
1. æ£€æŸ¥å‰ç«¯ä¼ é€’çš„ `answers` é”®åæ˜¯å¦æ­£ç¡®ï¼ˆåº”è¯¥æ˜¯é¢˜ç›® IDï¼Œå¦‚ `'1_3m-OSV-001'`ï¼‰
2. æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„é¢˜ç›®æ•°æ®
3. ç¡®è®¤é¢˜ç›®æ•°æ®çš„ `qid` å­—æ®µæ ¼å¼æ˜¯å¦åŒ¹é…

#### é”™è¯¯ï¼šæ²¡æœ‰æœ‰æ•ˆçš„ç­”æ¡ˆæ•°æ®
**åŸå› **ï¼šç­”æ¡ˆå€¼ä¸æ˜¯ 0 æˆ– 1ï¼Œæˆ–æ‰€æœ‰é¢˜ç›®éƒ½æœªåœ¨æ•°æ®åº“ä¸­æ‰¾åˆ°
**è§£å†³**ï¼š
1. æ£€æŸ¥å‰ç«¯ `answers` å¯¹è±¡çš„å€¼æ˜¯å¦éƒ½æ˜¯ 0 æˆ– 1
2. æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„é¢˜ç›®è®°å½•

#### é”™è¯¯ï¼šæ•°æ®åº“å†™å…¥å¤±è´¥
**åŸå› **ï¼šå¯èƒ½è¿å schema çº¦æŸï¼ˆå¦‚ required å­—æ®µç¼ºå¤±ã€æšä¸¾å€¼ä¸åŒ¹é…ç­‰ï¼‰
**è§£å†³**ï¼š
1. æŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥å†™å…¥çš„æ•°æ®æ˜¯å¦åŒ…å«æ‰€æœ‰ required å­—æ®µ
3. ç¡®è®¤ `level` å€¼æ˜¯å¦åœ¨æšä¸¾èŒƒå›´å†…

## ğŸ“ ä¸‹ä¸€æ­¥

1. **ä¸Šä¼ äº‘å‡½æ•°**ï¼šåœ¨ HBuilderX ä¸­å³é”®äº‘å‡½æ•°ç›®å½•ï¼Œé€‰æ‹©"ä¸Šä¼ éƒ¨ç½²"
2. **æµ‹è¯•æäº¤**ï¼šå®Œæˆä¸€æ¬¡è¯„ä¼°å¹¶æäº¤ï¼Œæ£€æŸ¥æ˜¯å¦èƒ½æˆåŠŸå†™å…¥æ•°æ®åº“
3. **æŸ¥çœ‹æ—¥å¿—**ï¼šåœ¨ uniCloud Web æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—
4. **éªŒè¯æ•°æ®**ï¼šæ£€æŸ¥æ•°æ®åº“ä¸­çš„è®°å½•æ˜¯å¦åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `uniCloud-aliyun/cloudfunctions/submitAssessment/index.js` - æäº¤è¯„ä¼°äº‘å‡½æ•°
- `uniCloud-aliyun/cloudfunctions/saveAssessment/index.js` - ä¿å­˜è‰ç¨¿äº‘å‡½æ•°
- `uniCloud-aliyun/cloudfunctions/submitAssessment/calc.js` - è®¡ç®—å·¥å…·ï¼ˆå·²ä¿®å¤ levelï¼‰
- `uniCloud-aliyun/cloudfunctions/saveAssessment/calc.js` - è®¡ç®—å·¥å…·
- `uniCloud-aliyun/database/assessments.schema.json` - æ•°æ®åº“ schema

