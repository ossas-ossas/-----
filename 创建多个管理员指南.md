# 📝 创建多个管理员账户指南

## ✅ 已完成的修改

已将 `uni-id-co` 云函数中的管理员创建限制修改为：
- **原限制**：只能创建1个管理员
- **新限制**：最多可以创建5个管理员

**修改的文件：**
```
uni_modules/uni-id-pages/uniCloud/cloudfunctions/uni-id-co/module/register/register-admin.js
```

---

## 🚀 使用步骤

### Step 1: 上传云函数（重要！）

修改代码后**必须重新上传云函数**才能生效：

1. 在 HBuilderX 中找到：
   ```
   uni_modules/uni-id-pages/uniCloud/cloudfunctions/uni-id-co
   ```

2. **右键点击 `uni-id-co` 文件夹**

3. 选择：**"上传部署云对象"**

4. 等待上传完成（控制台会显示成功提示）

---

### Step 2: 创建管理员账户

现在可以通过注册页面创建5个管理员了！

#### 方法1：通过小程序界面（推荐）

1. **访问管理员注册页面**：
   ```
   /uni_modules/uni-id-pages/pages/register/register-admin
   ```

2. **依次创建5个管理员**，例如：
   
   **管理员1**
   - 用户名：`admin1`
   - 昵称：`主管理员`
   - 密码：`admin123456`（建议实际使用时设置强密码）
   
   **管理员2**
   - 用户名：`admin2`
   - 昵称：`副管理员`
   - 密码：`admin123456`
   
   **管理员3**
   - 用户名：`admin3`
   - 昵称：`技术管理员`
   - 密码：`admin123456`
   
   **管理员4**
   - 用户名：`admin4`
   - 昵称：`内容管理员`
   - 密码：`admin123456`
   
   **管理员5**
   - 用户名：`admin5`
   - 昵称：`运营管理员`
   - 密码：`admin123456`

3. **注册成功后**，每个账户都会自动拥有管理员权限

---

#### 方法2：在小程序中导航

如果你在小程序中找不到注册页面，可以：

1. 在小程序任意页面的控制台执行：
   ```javascript
   uni.navigateTo({
     url: '/uni_modules/uni-id-pages/pages/register/register-admin'
   })
   ```

2. 或者在代码中添加入口链接

---

### Step 3: 验证管理员权限

1. 使用任意新创建的管理员账户登录
2. 登录后应该会自动跳转到**管理员面板**
3. 在管理员面板中可以：
   - 查看所有儿童档案
   - 查看所有评估记录
   - 初始化题目数据
   - 管理系统

---

## 🎯 快速测试

### 测试云函数是否生效

在小程序中运行以下代码，检查当前管理员数量：

```javascript
uniCloud.database().collection('uni-id-users')
  .where({
    role: 'admin'
  })
  .count()
  .then(res => {
    console.log('当前管理员数量:', res.total)
    console.log('还可以创建:', 5 - res.total, '个管理员')
  })
```

---

## 📋 注意事项

### 1. 上传云函数是必须的

⚠️ **必须重新上传 `uni-id-co` 云对象**，否则代码修改不会生效！

上传步骤：
- 右键 `uni-id-co` → "上传部署云对象"
- 等待上传完成
- 重新编译小程序

### 2. 管理员数量限制

- ✅ 最多可以创建 **5个** 管理员
- ❌ 尝试创建第6个时会提示："管理员数量已达上限（当前5个，最多5个）"
- 如果需要更多，可以修改代码中的数字 `5` 为其他值

### 3. 密码安全建议

- 🔒 为每个管理员设置**不同的强密码**
- 🔒 密码建议包含：大小写字母、数字、特殊字符
- 🔒 定期更换密码

### 4. 权限说明

- 所有管理员拥有**相同的权限**
- 可以访问管理员面板的所有功能
- 如果需要区分权限，需要额外开发权限系统

---

## 🔧 修改管理员数量上限

如果你想修改数量限制（比如改为10个），编辑以下文件：

```
uni_modules/uni-id-pages/uniCloud/cloudfunctions/uni-id-co/module/register/register-admin.js
```

找到第42行，修改数字：

```javascript
// 将 5 改为你想要的数量
if (getAdminRes.data.length >= 5) {  // ← 修改这里
  return {
    errCode: ERROR.ADMIN_EXISTS,
    errMsg: `管理员数量已达上限（当前${getAdminRes.data.length}个，最多5个）`  // ← 修改这里
  }
}
```

修改后记得重新上传云函数！

---

## 🐛 常见问题

### Q1: 上传云函数后，仍然提示"管理员已存在"？

**解决方法：**
1. 确认云函数上传成功（查看 HBuilderX 控制台输出）
2. 清除小程序缓存，重新编译
3. 关闭微信开发者工具，重新打开

### Q2: 如何查看已创建的管理员列表？

**方法1：在 uniCloud 控制台**
- 访问：https://unicloud.dcloud.net.cn
- 云数据库 → `uni-id-users`
- 筛选条件：`role` 包含 `admin`

**方法2：在小程序控制台运行**
```javascript
uniCloud.database().collection('uni-id-users')
  .where({
    role: 'admin'
  })
  .field({ username: true, nickname: true, register_date: true })
  .get()
  .then(res => {
    console.log('管理员列表:', res.result.data)
  })
```

### Q3: 如何删除某个管理员？

1. 打开 uniCloud 控制台
2. 云数据库 → `uni-id-users`
3. 找到要删除的管理员
4. 点击"删除"按钮

或者修改 `role` 字段，将 `["admin"]` 改为 `[]`（降级为普通用户）

### Q4: 创建管理员时提示"数据库繁忙"？

这是因为数据库配额用完了。解决方法：
1. 等待一段时间后重试
2. 在 uniCloud 控制台检查数据库配额
3. 升级云服务空间套餐

---

## 📞 需要帮助？

如果遇到问题：
1. 查看 HBuilderX 控制台的错误信息
2. 查看 uniCloud Web 控制台的云函数日志
3. 确认云函数已成功上传
4. 确认小程序已重新编译

---

## ✅ 完成清单

在创建管理员前，请确认：

- [ ] 已修改云函数代码（✅ 已完成）
- [ ] 已重新上传 `uni-id-co` 云对象
- [ ] 已重新编译小程序
- [ ] 可以访问管理员注册页面
- [ ] 成功创建第一个管理员（已有）
- [ ] 成功创建第二个管理员
- [ ] 成功创建第三个管理员
- [ ] 成功创建第四个管理员
- [ ] 成功创建第五个管理员
- [ ] 所有管理员都能登录并访问管理员面板

---

**现在就可以开始创建管理员了！记得先上传云函数哦！** 🎉

