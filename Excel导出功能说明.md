# Excel导出功能使用说明

## 功能概述

管理员面板的评估记录表格视图中新增了**Excel导出功能**，可以将评估数据导出为Excel文件，包含两个工作表：
1. **细项分析表** - 综合能力检测分析图（年龄段×子领域统计）
2. **未完成题目列表** - 按年龄段和子领域分组的详细题目列表

## 安装依赖

在开始使用之前，需要安装xlsx库：

```bash
npm install
```

如果npm install失败，请手动安装xlsx：

```bash
npm install xlsx@0.18.5
```

## 使用方法

1. **登录管理员账号**
   - 使用管理员账号登录小程序

2. **进入管理员面板**
   - 首页会自动提示跳转，或手动导航到管理员面板

3. **查看评估记录**
   - 切换到"评估记录"标签页
   - 点击"表格"视图模式切换按钮

4. **导出Excel**
   - 在表格标题右侧找到"导出Excel"按钮（绿色按钮）
   - 点击按钮开始导出
   - 文件会自动下载，文件名格式：`{儿童姓名}_发育评估报告_{时间}.xlsx`

## 导出内容说明

### Sheet 1: 细项分析

包含以下内容：
- **表头第一行**：发育时间（跨行）+ 大领域（五大感知觉发展、动作、社会互动、认知、语言、口腔动作）
- **表头第二行**：各子领域名称（简化版，如"视知觉"、"听知觉"等）
- **数据行**：每个年龄段（60-72个月、48-60个月等）对应的各子领域完成情况（格式：已完成/总数，如"3/5"）

特点：
- ✅ 发育时间单元格跨两行合并
- ✅ 大领域单元格根据子领域数量自动合并
- ✅ 列宽自动调整，便于查看
- ✅ 数据与界面表格完全一致

### Sheet 2: 未完成题目

包含以下内容：
- **标题信息**：儿童姓名、评估时间、总未完成题目数
- **按年龄段分组**：每个年龄段单独显示，带有年龄段标题（如【60-72个月】）
- **三级结构**：
  - 第一级：年龄段（如60-72个月、48-60个月等）
  - 第二级：领域（五大感知觉发展、动作、社会互动、认知、语言、口腔动作）
  - 第三级：子领域（视知觉、听知觉、触知觉等）
  - 具体内容：每个子领域下的所有未完成题目

特点：
- ✅ 按年龄段从大到小排序（60-72个月 → 48-60个月 → ... → 0-3个月）
- ✅ 领域按标准顺序排列（感知觉 → 动作 → 社会互动 → 认知 → 语言 → 口腔动作）
- ✅ 同一子领域的多个题目会合并显示（领域和子领域列仅在第一题显示）
- ✅ 题目内容完整显示（列宽80字符）
- ✅ 如果所有题目都已完成，会显示"所有题目已完成！"

**表格格式示例**：
```
未完成题目详细列表
儿童姓名：  张三
评估时间：  2025-01-11 10:30:25
总未完成数： 15题

【60-72个月】
领域          子领域              题目内容
五大感知觉    视知觉              能识别复杂图形中的目标物
                                  能完成拼图游戏（20片以上）
              听知觉              能听懂并执行三步指令
动作          精细动作            能用筷子夹取小物品
                                  能独立系鞋带

【48-60个月】
领域          子领域              题目内容
...
```

## 文件名格式

```
{儿童姓名}_发育评估报告_{时间戳}.xlsx
```

示例：
```
张三_发育评估报告_2025-01-11T02-43-15.xlsx
```

## 技术说明

- **库**：使用 [SheetJS (xlsx)](https://sheetjs.com/) 库生成Excel文件
- **版本**：xlsx@0.18.5
- **兼容性**：支持微信小程序开发工具和H5浏览器预览
- **文件格式**：Excel 2007+ (.xlsx)

## 注意事项

1. **首次使用前必须运行 `npm install`** 安装xlsx依赖
2. **微信小程序环境**：导出功能在开发者工具中可以正常使用，真机预览需要配置downloadFile域名
3. **文件大小**：单个评估记录导出的Excel文件通常小于100KB
4. **浏览器兼容**：建议使用Chrome、Edge等现代浏览器
5. **合并单元格**：Excel中的合并单元格与网页表格完全一致

## 故障排除

### 1. 点击"导出Excel"按钮没有反应

**原因**：xlsx库未安装或导入失败

**解决方法**：
```bash
# 进入项目目录
cd C:\Users\86182\Documents\HBuilderProjects\前端小程序

# 安装依赖
npm install
```

### 2. 导出时提示"导出失败"

**可能原因**：
- 评估数据缺失或格式不正确
- 浏览器不支持文件下载

**解决方法**：
- 检查控制台错误信息
- 尝试使用其他浏览器
- 确认评估数据完整

### 3. Excel文件打开后格式错乱

**原因**：Excel版本过旧

**解决方法**：
- 使用Excel 2007或更高版本
- 或使用WPS Office、LibreOffice等支持.xlsx格式的软件

## 更新日志

### v1.0.0 (2025-01-11)
- ✅ 初始版本发布
- ✅ 支持细项分析表导出
- ✅ 支持未完成题目列表导出
- ✅ 实现发育时间跨行合并
- ✅ 实现大领域自动合并
- ✅ 文件名包含儿童姓名和时间戳
- ✅ 优化列宽和表格样式

## 反馈与支持

如有问题或建议，请联系开发团队。

