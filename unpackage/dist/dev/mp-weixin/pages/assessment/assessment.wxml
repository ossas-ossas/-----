<view class="container"><block wx:if="{{currentAgeBand}}"><view class="age-info"><text class="age-text">{{currentAgeBand.label+" 发育评估"}}</text><block wx:if="{{isCorrectedAge}}"><text class="mode-text">（纠正后）</text></block><view class="mode-switch"><button data-event-opts="{{[['tap',[['switchMode',['band']]]]]}}" class="{{['mode-btn',(assessmentMode==='band')?'active':'']}}" bindtap="__e">精准模式</button><button data-event-opts="{{[['tap',[['switchMode',['cumulative']]]]]}}" class="{{['mode-btn',(assessmentMode==='cumulative')?'active':'']}}" bindtap="__e">累进模式</button></view></view></block><view class="progress-container"><text class="progress-text">{{"已完成 "+checkedCount+" / "+totalCount+" 题"}}</text><view class="progress-bar"><view class="progress-fill" style="{{'width:'+(progressPercent+'%')+';'}}"></view></view></view><block wx:if="{{totalCount>0}}"><view class="questions-container"><block wx:for="{{$root.l0}}" wx:for-item="list" wx:for-index="domain" wx:key="domain"><view class="domain-section"><view data-event-opts="{{[['tap',[['toggleDomain',[domain]]]]]}}" class="domain-header" bindtap="__e"><text class="domain-title">{{domain}}</text><text class="domain-count">{{list.g0+" 题"}}</text><text class="domain-toggle">{{expandedDomains[domain]?'▼':'▶'}}</text></view><block wx:if="{{expandedDomains[domain]}}"><view class="domain-questions"><block wx:for="{{list.$orig}}" wx:for-item="q" wx:for-index="idx" wx:key="id"><view class="{{['card',(q.checked)?'selected':'']}}"><view class="card-hd"><text class="no">{{idx+1}}</text><text class="title">{{q.text}}</text></view><checkbox-group data-event-opts="{{[['change',[['e0',['$event']]]]]}}" data-event-params="{{({q})}}" bindchange="__e"><label class="chk"><checkbox value="{{q.id}}" checked="{{q.checked}}"></checkbox><text>孩子能否完成此项目</text></label></checkbox-group></view></block></view></block></view></block></view></block><block wx:else><view class="no-questions"><text class="no-questions-text">该年龄段暂无评估题目</text><text class="no-questions-hint">请联系老师补充题库</text></view></block><view class="button-container"><button class="submit-button" disabled="{{isSubmitting||totalCount===0}}" data-event-opts="{{[['tap',[['submitAssessment',['$event']]]]]}}" bindtap="__e"><text class="button-text">{{''+(isSubmitting?'提交中...':'提交评估')+''}}</text></button></view><block wx:if="{{isSubmitting}}"><view class="loading-mask"><view class="loading-content"><view class="loading-spinner"></view><text class="loading-text">正在生成报告...</text></view></view></block></view>