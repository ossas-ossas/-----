<view class="container"><view class="top-bar"><view class="top-header"><text class="page-title">å‘è‚²è¯„ä¼°</text><text class="global-stats">{{derivedStats.global.selected+"/"+derivedStats.global.total+" ("+derivedStats.global.ratio+"%)"}}</text></view><view class="search-box"><input class="search-input" placeholder="æœç´¢é¢˜ç›®..." data-event-opts="{{[['input',[['__set_model',['$0','keyword','$event',[]],['filters']],['applyFilters',['$event']]]]]}}" value="{{filters.keyword}}" bindinput="__e"/><text class="search-icon">ğŸ”</text></view><view class="filter-switch"><switch checked="{{filters.onlyUnfinished}}" data-event-opts="{{[['change',[['onUnfinishedToggle',['$event']]]]]}}" bindchange="__e"></switch><text class="switch-label">ä»…çœ‹æœªå®Œæˆ</text></view></view><view class="questions-container"><block wx:for="{{$root.l2}}" wx:for-item="domain" wx:for-index="__i0__" wx:key="$orig"><block wx:if="{{domain.m0}}"><view class="domain-section"><view data-event-opts="{{[['tap',[['toggleDomain',['$0'],[[['allDomains','',__i0__]]]]]]]}}" class="domain-header" bindtap="__e"><text class="domain-title">{{domain.m1}}</text><block wx:if="{{derivedStats.byDomain[domain.$orig]}}"><text class="domain-stats">{{''+derivedStats.byDomain[domain.$orig].selected+"/"+derivedStats.byDomain[domain.$orig].total+"\n\t\t\t\t\t\t("+derivedStats.byDomain[domain.$orig].ratio+'%)'}}</text></block><view class="domain-actions"><text data-event-opts="{{[['tap',[['selectAllInDomain',['$0'],[[['allDomains','',__i0__]]]]]]]}}" class="action-btn" catchtap="__e">å…¨é€‰</text><text data-event-opts="{{[['tap',[['clearDomain',['$0'],[[['allDomains','',__i0__]]]]]]]}}" class="action-btn" catchtap="__e">æ¸…ç©º</text></view><text class="domain-toggle">{{''+(expandedDomains[domain.$orig]?'â–¼':'â–¶')+''}}</text></view><block wx:if="{{expandedDomains[domain.$orig]}}"><view class="domain-content"><block wx:for="{{domain.l1}}" wx:for-item="subdomain" wx:for-index="__i1__"><block wx:if="{{subdomain.m2}}"><view class="subdomain-section"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" data-event-params="{{({domain:domain.$orig,subdomain:subdomain.$orig})}}" class="subdomain-header" bindtap="__e"><text class="subdomain-title">{{subdomain.m3}}</text><block wx:if="{{derivedStats.bySubdomain[domain.$orig]&&derivedStats.bySubdomain[domain.$orig][subdomain.$orig]}}"><text class="subdomain-stats">{{''+derivedStats.bySubdomain[domain.$orig][subdomain.$orig].selected+"/"+derivedStats.bySubdomain[domain.$orig][subdomain.$orig].total+"\n\t\t\t\t\t\t\t\t("+derivedStats.bySubdomain[domain.$orig][subdomain.$orig].ratio+'%)'}}</text></block><view class="subdomain-actions"><text data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" data-event-params="{{({domain:domain.$orig,subdomain:subdomain.$orig})}}" class="action-btn" catchtap="__e">å…¨é€‰</text><text data-event-opts="{{[['tap',[['e2',['$event']]]]]}}" data-event-params="{{({domain:domain.$orig,subdomain:subdomain.$orig})}}" class="action-btn" catchtap="__e">æ¸…ç©º</text></view><text class="subdomain-toggle">{{''+(expandedSubdomains[domain.$orig+'::'+subdomain.$orig]?'â–¼':'â–¶')+''}}</text></view><block wx:if="{{expandedSubdomains[domain.$orig+'::'+subdomain.$orig]}}"><view class="subdomain-questions"><block wx:for="{{subdomain.l0}}" wx:for-item="q" wx:for-index="__i2__" wx:key="id"><view data-event-opts="{{[['tap',[['e3',['$event']]]]]}}" data-event-params="{{({q})}}" class="{{['question-card',(answers[q.id]===1)?'selected':'']}}" bindtap="__e"><view class="question-content"><checkbox-group><label class="question-label"><checkbox value="{{q.id}}" checked="{{answers[q.id]===1}}"></checkbox><text class="question-text">{{q.text}}</text></label></checkbox-group></view></view></block></view></block></view></block></block></view></block></view></block></block></view><view class="bottom-bar"><view class="progress-bar-container"><text class="progress-text">{{derivedStats.global.selected+"/"+derivedStats.global.total}}</text><view class="progress-bar"><view class="progress-fill" style="{{'width:'+(derivedStats.global.ratio+'%')+';'}}"></view></view></view><view class="bottom-actions"><button data-event-opts="{{[['tap',[['saveDraft',['$event']]]]]}}" class="action-btn" bindtap="__e"><text>ä¿å­˜è‰ç¨¿</text></button><button class="action-btn primary" disabled="{{isSubmitting}}" data-event-opts="{{[['tap',[['submitAssessment',['$event']]]]]}}" bindtap="__e"><text>{{isSubmitting?'æäº¤ä¸­...':'æäº¤è¯„ä¼°'}}</text></button><button data-event-opts="{{[['tap',[['scrollToTop',['$event']]]]]}}" class="action-btn" bindtap="__e"><text>å›åˆ°é¡¶éƒ¨</text></button></view></view><block wx:if="{{isSubmitting}}"><view class="loading-mask"><view class="loading-content"><view class="loading-spinner"></view><text class="loading-text">æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...</text></view></view></block></view>