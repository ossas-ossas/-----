# 登录系统使用说明

## 📋 已完成的功能

### 1. 完整的登录系统
基于 uni-id-pages 官方模板，支持多种登录方式：

#### 🔐 支持的登录方式
- ✅ **用户名密码登录** - 全平台支持
- ✅ **手机验证码登录** - 全平台支持
- ✅ **微信登录** - 小程序和H5支持（需配置appid）
- ✅ **邮箱注册登录** - 全平台支持
- ✅ **一键登录** - 仅APP支持
- ✅ **Apple登录** - 仅APP支持
- ✅ **华为登录** - 仅鸿蒙支持

### 2. 页面功能

#### 📱 首页 (`pages/index/index.vue`)
- 检查登录状态，显示"登录/注册"或"个人中心"
- 点击"开始评估"时检查登录：
  - 未登录：提示并引导登录
  - 已登录：直接进入儿童信息页
- 管理员自动重定向到管理员面板

#### 👤 个人中心 (`pages/user-center/user-center.vue`)
- 显示用户信息和头像
- 管理员徽章标识
- 功能菜单：
  - 新建评估
  - 历史记录
  - 管理员功能（仅管理员可见）
  - 个人资料
  - 修改密码
  - 退出登录

#### 📝 儿童信息页 (`pages/child-info/child-info.vue`)
- 页面加载时检查登录状态
- 未登录显示登录提示卡片
- 已登录才显示表单内容

#### 🔐 登录相关页面
所有 uni-id-pages 提供的登录、注册、找回密码等页面都已配置：
- 用户名密码登录：`/uni_modules/uni-id-pages/pages/login/login-withpwd`
- 手机验证码登录：`/uni_modules/uni-id-pages/pages/login/login-smscode`
- 用户注册：`/uni_modules/uni-id-pages/pages/register/register`
- 邮箱注册：`/uni_modules/uni-id-pages/pages/register/register-by-email`
- 找回密码：`/uni_modules/uni-id-pages/pages/retrieve/retrieve`
- 个人资料：`/uni_modules/uni-id-pages/pages/userinfo/userinfo`
- 修改密码：`/uni_modules/uni-id-pages/pages/userinfo/change_pwd/change_pwd`

### 3. 配置文件

#### uni-id-pages 配置 (`uni_modules/uni-id-pages/config.js`)
```javascript
{
  loginTypes: [
    'username',  // 用户名密码
    'smsCode',   // 短信验证码
    'weixin',    // 微信登录（需配置）
    // ... 其他
  ],
  passwordStrength: 'weak', // 密码强度：弱（便于注册）
  agreements: {
    serviceUrl: 'https://www.example.com/service', // 请替换
    privacyUrl: 'https://www.example.com/privacy'  // 请替换
  }
}
```

## 🚀 使用流程

### 普通用户流程
1. 打开应用 → 首页
2. 点击"开始评估" → 提示登录
3. 点击"去登录" → 登录页面
4. 注册/登录成功 → 自动返回
5. 再次点击"开始评估" → 进入儿童信息页
6. 点击"个人中心" → 查看个人信息、历史记录等

### 管理员流程
1. 使用管理员账号登录
2. 自动跳转到管理员面板
3. 可以：
   - 查看所有儿童档案
   - 查看所有评估记录
   - 初始化题目数据
   - 管理系统

## ⚙️ 需要配置的内容

### 1. 微信登录（可选）
如需启用微信登录，请在 `uni_modules/uni-id-pages/config.js` 中配置：
```javascript
appid: {
  weixin: {
    h5: '你的微信公众号appid',
    web: '你的微信开放平台appid'
  }
}
```

### 2. 政策协议链接
请在 `uni_modules/uni-id-pages/config.js` 中替换：
```javascript
agreements: {
  serviceUrl: '你的用户服务协议链接',
  privacyUrl: '你的隐私政策链接'
}
```

### 3. 短信服务（可选）
如需使用短信验证码登录，请在 uniCloud 控制台配置短信服务商。

## 🎯 测试步骤

### 1. 测试注册登录
```
1. 点击首页"登录/注册"
2. 选择"用户名密码登录"
3. 点击"注册账号"
4. 填写信息并注册
5. 登录成功后自动返回首页
```

### 2. 测试评估流程
```
1. 首页点击"开始评估"
2. 未登录会提示，点击"去登录"
3. 登录后再点击"开始评估"
4. 成功进入儿童信息页
5. 填写信息并开始评估
```

### 3. 测试管理员功能
```
1. 使用管理员账号登录
2. 自动跳转到管理员面板
3. 可以查看所有数据
4. 点击"初始化题目"管理题库
5. 点击"退出登录"返回首页
```

## 📝 注意事项

1. **密码强度**：当前设置为"weak"（弱），便于测试。生产环境建议改为"medium"或"strong"。

2. **Token有效期**：默认7天。可在 uniCloud 控制台的 uni-id 配置中修改。

3. **自动登录**：Token有效期内会自动登录，无需重复登录。

4. **退出登录**：清除本地 Token，下次需要重新登录。

5. **权限控制**：
   - 普通用户只能查看自己的数据
   - 管理员可以查看所有数据
   - 权限由 JWT Token 中的 role 字段控制

## 🔧 常见问题

### Q: 如何创建管理员账号？
A: 访问 `/uni_modules/uni-id-pages/pages/register/register-admin` 注册管理员账号。

### Q: 登录后为什么还是提示未登录？
A: 检查 Token 是否过期，或者刷新页面重试。

### Q: 如何配置短信登录？
A: 需要在 uniCloud 控制台配置短信服务商（阿里云或腾讯云）。

### Q: 微信登录如何开启？
A: 需要配置微信 appid，并在微信开放平台/公众平台获取相应权限。

## 📚 相关文档

- [uni-id-pages 官方文档](https://uniapp.dcloud.net.cn/uniCloud/uni-id-pages.html)
- [uni-id 用户系统](https://uniapp.dcloud.net.cn/uniCloud/uni-id.html)
- [uniCloud 云开发](https://uniapp.dcloud.net.cn/uniCloud/)


