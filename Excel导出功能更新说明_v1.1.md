# Excel导出功能更新说明 v1.1

## 更新时间
2025-01-11

## 更新内容

### 🎉 主要改进：优化Sheet2（未完成题目列表）

#### 之前的问题
- 未完成题目以简单列表形式展示
- 不易快速定位特定年龄段或子领域的问题
- 数据结构扁平，不便于分析

#### 现在的优势

**✅ 三级分组结构**
```
年龄段
  └─ 领域
      └─ 子领域
          └─ 具体题目
```

**✅ 清晰的年龄段划分**
- 每个年龄段单独显示，带有醒目的标题（如【60-72个月】）
- 按从大到小顺序排列（60-72个月 → 0-3个月）
- 空行分隔，易于阅读

**✅ 智能的数据合并**
- 同一领域的多个子领域：领域名只在第一个子领域显示
- 同一子领域的多个题目：子领域名只在第一题显示
- 避免重复信息，表格更简洁

**✅ 标准化的领域排序**
- 五大感知觉发展
- 动作
- 社会互动
- 认知
- 语言
- 口腔动作

## 导出效果对比

### Sheet 1：细项分析（无变化）
保持原有格式，包含：
- 发育时间跨行合并
- 大领域自动合并
- 所有年龄段 × 子领域的统计数据

### Sheet 2：未完成题目（全新优化）

#### 表头信息
```
未完成题目详细列表
儿童姓名：  李明
评估时间：  2025-01-11 14:30:00
总未完成数： 23题
```

#### 分组展示示例
```
【60-72个月】
领域              子领域                  题目内容
五大感知觉发展    视知觉                  能识别复杂图形中的目标物
                                          能在视觉干扰下找到目标
                  听知觉                  能听懂并执行三步以上指令
                  本体运动知觉            能进行跳绳等协调性活动
动作              精细动作                能用筷子夹取小物品
                                          能独立完成鞋带系法
社会互动          与人互动                能主动发起小组讨论
                  情绪与自我              能识别并表达复杂情绪

【48-60个月】
领域              子领域                  题目内容
认知              注意（动作）            能持续专注完成拼图30分钟
...
```

## 技术实现细节

### 数据结构
```javascript
// 三级分组
grouped = {
  '60_72m': {
    'sens': {
      'OSV': [题目1, 题目2, ...],
      'OSH': [题目3, ...]
    },
    'gross': { ... }
  },
  '48_60m': { ... }
}
```

### 智能显示逻辑
```javascript
items.forEach((item, itemIndex) => {
  if (subIndex === 0 && itemIndex === 0) {
    // 显示：领域 + 子领域 + 题目
  } else if (itemIndex === 0) {
    // 显示：空 + 子领域 + 题目
  } else {
    // 显示：空 + 空 + 题目
  }
});
```

### 列宽优化
- 领域列：20字符（适应中文领域名称）
- 子领域列：25字符（容纳完整子领域名称）
- 题目内容：80字符（确保题目内容完整显示）

## 使用方法（无变化）

1. 登录管理员账号
2. 进入管理员面板 → 评估记录
3. 切换到"表格"视图
4. 点击"导出Excel"按钮
5. 文件自动下载

## 文件内容

每个Excel文件包含2个工作表：
1. **细项分析** - 年龄段×子领域统计表
2. **未完成题目** - 三级分组的详细题目列表

## 适用场景

### Sheet 1 适用于
- 快速了解整体发育情况
- 对比不同年龄段的完成率
- 评估各子领域的发展水平

### Sheet 2 适用于
- 制定针对性训练计划
- 按年龄段安排干预重点
- 向家长说明具体需要改进的项目
- 追踪特定领域/子领域的进展

## 注意事项

1. **数据完整性**：确保评估记录包含完整的ageBand、domain、subdomain信息
2. **Excel兼容性**：使用Excel 2007+或WPS Office打开
3. **依赖安装**：首次使用前必须运行 `npm install`
4. **浏览器支持**：建议使用Chrome、Edge等现代浏览器

## 故障排除

### 问题：Sheet2内容为空
**原因**：所有题目都已完成
**显示**："所有题目已完成！"

### 问题：某个年龄段没有显示
**原因**：该年龄段的题目都已完成
**正常**：只显示有未完成题目的年龄段

### 问题：领域/子领域显示为"未知"
**原因**：数据库中该题目缺少domain或subdomain字段
**解决**：检查题库数据完整性

## 版本历史

### v1.1.0 (2025-01-11)
- ✅ 优化Sheet2结构为三级分组
- ✅ 添加年龄段标题和分隔
- ✅ 实现智能数据合并显示
- ✅ 优化列宽适应中文内容
- ✅ 添加总未完成题目数统计

### v1.0.0 (2025-01-11)
- ✅ 初始版本发布
- ✅ 支持细项分析表导出
- ✅ 支持未完成题目列表导出
- ✅ 实现发育时间跨行合并
- ✅ 实现大领域自动合并

## 反馈建议

如有问题或改进建议，请联系开发团队。

